!function(factory){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?factory(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],factory):factory(ko,ko.mapping={})}(function(ko,exports){var breaker={},nativeForEach=Array.prototype.forEach,toString=Object.prototype.toString,isArray=Array.isArray||function(obj){return"[object Array]"==toString.call(obj)},isString=function(obj){return"[object String]"==toString.call(obj)},isObject=function(obj){return obj===Object(obj)},isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},isNumber=function(obj){return toString.call(obj)=="[object "+Number+"]"||!isNaN(obj)},isFunction=function(obj){return toString.call(obj)=="[object "+Function+"]"},isDate=function(obj){return toString.call(obj)=="[object "+Date+"]"};"function"!=typeof/./&&(isFunction=function(obj){return"function"==typeof obj});var each=function(obj,iterator,context){if(null!==obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(isArray(obj)){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(iterator.call(context,obj[key],key,obj)===breaker)return};exports.toJSONByPrototype=ko.toJSONByPrototype=function(VM,M){var self=VM;return function(_m){var toInnerJSON=function(obj,dataModel,viewModel){return Object.keys(dataModel).forEach(function(key){if(viewModel[key]){var value=dataModel[key];if(isArray(value)){obj[key]=[];var marray=viewModel[key](),isAnObject=value.length>0&&value[0]&&isObject(value[0]);isAnObject?each(marray,function(element){obj[key].push(toInnerJSON({},value[0],element))}):each(marray,function(element){obj[key].push(isFunction(element)?element():element)})}else isString(value)||isNumber(value)||isBoolean(value)?viewModel[key]&&isFunction(viewModel[key])&&(obj[key]=viewModel[key]()):isFunction(value)||isObject(value)&&isFunction(value.read)&&isFunction(value.write)||isObject(value)&&(obj[key]={},toInnerJSON(obj[key],dataModel[key],viewModel[key]))}}),obj};return toInnerJSON({},_m,self)}(M)},exports.updateViewModel=ko.updateViewModel=function(VM,M){var self=VM;return function(_m){var innerUpdateViewModel=function(data,viewModel,path){return data&&viewModel&&each(data,function(value,key){if(viewModel[key]){var name=path+"."+key;if(isArray(value)&&viewModel[key]){viewModel[key]([]);var isAnObject=value.length>0&&value[0]&&isObject(value[0]);isAnObject?each(value,function(element){viewModel[key].push(exports.mapObject({},element))}):viewModel[key](value)}else isString(value)||isNumber(value)||isBoolean(value)?viewModel[key]&&isFunction(viewModel[key])&&viewModel[key](value):isFunction(value)||isObject(value)&&isFunction(value.read)&&isFunction(value.write)||isObject(value)&&innerUpdateViewModel(value,viewModel[key],name)}}),viewModel};innerUpdateViewModel(_m,self,"")}(M)},exports.mapObject=ko.mapObject=function(VM,M,V,F,S){var self=VM;return function(_m,_v,_f,_s){var _MakeViewModel=function(data,viewModel,validationRules,context){var validation=validationRules||{};return each(data,function(value,key){if(isArray(value)){viewModel[key]=ko.observableArray(),validation[key]&&viewModel[key].extend(isArray(validation[key])&&validation[key].length>0?validation[key][0]:validation[key]);var isAnObject=value.length>0&&value[0]&&isObject(value[0]);isAnObject?each(value,function(element){viewModel[key].push(_MakeViewModel(element,{},{},context))}):each(value,function(element){viewModel[key].push(element)})}else isString(value)||isNumber(value)||isBoolean(value)||isDate(value)?(viewModel[key]=ko.observable(value),validation[key]&&viewModel[key].extend(validation[key])):isFunction(value)||isObject(value)&&isFunction(value.read)&&isFunction(value.write)||isObject(value)&&(viewModel[key]=value.__observable?ko.observable():{},_MakeViewModel(value,viewModel[key],validation[key],context))}),viewModel},_MakeComputerModel=function(data,viewModel,context){return each(data,function(value,key){if(isArray(value)){var isAnObject=value.length>0&&value[0]&&isObject(value[0]);isAnObject&&each(value,function(element){_MakeViewModel(element,{},context)})}else isString(value)||isNumber(value)||isBoolean(value)||isDate(value)||(isFunction(value)?viewModel[key]=ko.computed(value,context):isObject(value)&&isFunction(value.read)&&isFunction(value.write)?viewModel[key]=ko.computed(value,context):isObject(value)&&_MakeComputerModel(value,viewModel[key],context))}),viewModel},_MakeFunctions=function(_methods,viewModel){each(_methods,function(value,key){isArray(value)?(viewModel[key]=[],each(value,function(element){viewModel[key].push(element)})):isFunction(value)?viewModel[key]=value:isObject(value)&&(viewModel[key]||(viewModel[key]={}),_MakeFunctions(value,viewModel[key]))})};return each(_s,function(value,key){self[key]=value}),_MakeViewModel(_m,self,_v,self),_MakeComputerModel(_m,self,self),_MakeFunctions(_f,self),self.init&&self.init(),self}(M,V||{},F||{},S||{})}});